--/*
--  HIVE SCRIPT  : create_dim_member.hql
--  AUTHOR       : Bhautik Patel
--  DATE         : May 05, 2017
--  DESCRIPTION  : Creation of hive work_dim.dim_member
--*/
USE ${hiveconf:database};
DROP TABLE IF EXISTS  ${hiveconf:namespace}${hiveconf:table_name};
CREATE EXTERNAL TABLE ${hiveconf:database}.${hiveconf:namespace}${hiveconf:table_name}(
  member_id bigint,
  member_key bigint,
  household_key bigint,
  rid string,
  name_prefix string,
  first_name string,
  last_name string,
  name_suffix string,
  first_name_scrubbed string,
  last_name_scrubbed string,
  company_name string,
  city_scrubbed string,
  state_scrubbed string,
  zip_code_scrubbed string,
  zip4_scrubbed string,
  zip_full_scrubbed string,
  non_us_postal_code string,
  country_code string,
  dpv_key bigint,
  overlay_rank_key bigint,
  overlay_load_id bigint,
  overlay_date date,
  direct_mail_consent string,
  direct_mail_consent_date date,
  promotion_consent string,
  email_address string,
  valid_email string,
  email_consent string,
  email_consent_date date,
  sms_consent string,
  sms_consent_date date,
  valid_phone_for_call string,
  valid_phone_for_sms string,
  phone_ext string,
  phone_type string,
  phone_consent string,
  phone_nbr string,
  ean string,
  ean_type string,
  loyalty_id string,
  loyalty_type string,
  gender string,
  birth_date date,
  deceased string,
  address_is_prison string,
  ecommerce_customer_nbr string,
  legacy_customer_nbr string,
  customer_add_date date,
  customer_introduction_date date,
  record_info_key bigint,
  original_record_info_key bigint,
  match_type_key bigint,
  latitude decimal(10,2),
  longitude decimal(10,2),
  closest_store_key bigint,
  distance_to_closest_store decimal(10,2),
  second_closest_store_key bigint,
  distance_to_sec_closest_store decimal(10,2),
  preferred_store_key bigint,
  preferred_channel string,
  distance_to_preferred_store decimal(10,2),
  original_source_key bigint,
  current_source_key bigint,
  is_express_plcc string,
  first_trxn_date date,
  first_trxn_store_key bigint,
  last_store_purch_date date,
  last_web_purch_date date,
  ads_do_not_statement_insert string,
  ads_do_not_sell_name string,
  ads_spam_indicator string,
  ads_email_change_date date,
  ads_return_mail_ind string,
  cm_gender_merch_descr string,
  record_type string,
  ip_code bigint,
  current_tier_key bigint,
  member_status string,
  member_acct_open_date date,
  member_acct_close_date date,
  member_acct_enroll_date date,
  printed_card_req_date date,
  printed_cert_opt_in string,
  printed_cert_opt_in_date date,
  e_cert_opt_in string,
  e_cert_opt_in_date date,
  facebook_id string,
  twitter_id string,
  lw_enrollment_source_key bigint,
  lw_enrollment_store_key bigint,
  ncoa_last_change_date date,
  prospect_mb_purch_count bigint,
  prospect_appearance_count bigint,
  prospect_contact_count bigint,
  member_acct_open_date_key bigint,
  member_acct_close_date_key bigint,
  member_acct_enroll_date_key bigint,
  printed_card_req_date_key bigint,
  printed_cert_opt_in_date_key bigint,
  e_cert_opt_in_date_key bigint,
  customer_add_date_key bigint,
  customer_introduction_date_key bigint,
  first_trxn_date_key bigint,
  last_store_purch_date_key bigint,
  last_web_purch_date_key bigint,
  is_dm_marketable string,
  is_em_marketable string,
  is_sms_marketable string,
  closest_store_state string,
  is_loyalty_member string,
  preferred_store_state string,
  second_closest_store_state string,
  tier_name string,
  valid_loose string,
  valid_strict string,
  global_opt_out string,
  best_household_member string,
  address1_scrubbed string,
  address2_scrubbed string,
  county string,
  address_mailable string,
  member_source string,
  language_preference string,
  security_question string,
  request_loyalty_card string,
  request_paper_cert_date date,
  address_type  string,
  preapproval_number  string,
  preapproval_expiration_date  date,
  communications_pref   string,
  cdh_member_key  string,
  opt_status string,
  token_nbr_association_request string,
  confirm_age_eighteen string,
  plcc_request_date date,
  plcc_request_user_id string,
  address1 string,
  address2 string,
  city string,
  state string,
  zip_code string,
  zip4 string,
  name_prefix_scrubbed string,
  gender_scrubbed string,
  name_suffix_scrubbed string,
  country_code_scrubbed string,
  dwelling_type string,
  is_plcc_request string,
  last_updated_date timestamp,
  batch_id string,
  member_acct_open_date_time timestamp)
  PARTITIONED BY(status string)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY '\001'
STORED AS ORC
LOCATION '${hiveconf:location}';